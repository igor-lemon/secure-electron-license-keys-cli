"use strict";var _arg=_interopRequireDefault(require("arg"));Object.defineProperty(exports,"__esModule",{value:!0}),exports.cli=cli;function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var crypto=require("crypto"),fs=require("fs"),path=require("path"),uuid=require("uuid"),add=require("date-fns/add");function parseArgumentsIntoOptions(a){var b=(0,_arg["default"])({"--major":String,"--minor":String,"--patch":String,"--user":String,"--expire":String,"--public":String,"--private":String,"--license":String,"--output":String,"--private-key":String,"--public-key":String,"--valid-to":String,"-ma":"--major","-mi":"--minor","-pa":"--patch","-u":"--user","-e":"--expire","-pu":"--public","-pr":"--private","-l":"--license","-o":"--output","-pk":"--private-key","-pubk":"--public-key","-vt":"--valid-to"},{permissive:!1,argv:a.slice(2),stopAtPositional:!1});return{major:b["--major"]||"*",minor:b["--minor"]||"*",patch:b["--patch"]||"*",user:b["--user"]||"",expire:b["--expire"]||"",public:b["--public"]||"public.key",private:b["--private"]||"private.key",license:b["--license"]||"license.data",output:b["--output"]||process.cwd(),privateKeyPath:b["--private-key"]||null,publicKeyPath:b["--public-key"]||null,validTo:b["--valid-to"]||null}}var cryptoKeyPairOptions={modulusLength:4096,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}};function cli(a){var b=parseArgumentsIntoOptions(a),c=b.user,d=b.validTo,e=b.expire;if(!c)throw new Error("Please pass an email of the user");var f=null,g=new Date;if(d){var h=d.match(/^years-(\d*)$/i),i=d.match(/^months-(\d*)$/i),j=d.match(/^days-(\d*)$/i),k=d.match(/^hours-(\d*)$/i),l=d.match(/^minutes-(\d*)$/i),m=d.match(/^seconds-(\d*)$/i);h&&h[1]?f=add(g,{years:h[1]}):i&&i[1]?f=add(g,{months:i[1]}):j&&j[1]?f=add(g,{days:j[1]}):k&&k[1]?f=add(g,{hours:k[1]}):l&&l[1]?f=add(g,{minutes:l[1]}):m&&m[1]&&(f=add(g,{seconds:m[1]}))}var n,o,p={id:uuid.v4(),major:b.major,minor:b.minor,patch:b.patch,user:c,created:g,validTo:f,expire:e?new Date(e):null},q=b.privateKeyPath,r=b.publicKeyPath,s=!1;if(q&&r)n=fs.readFileSync(path.resolve(q)),o=fs.readFileSync(path.resolve(r)),s=!0;else{var x=crypto.generateKeyPairSync("rsa",cryptoKeyPairOptions);o=x.publicKey,n=x.privateKey}var t=crypto.privateEncrypt(n,Buffer.from(JSON.stringify(p))),u=path.join(b.output,b["public"]),v=path.join(b.output,b["private"]),w=path.join(b.output,b.license);console.log("".concat(s?"Using":"Saving"," public key file at '").concat(u,"'.")),fs.writeFileSync(u,o),console.log("".concat(s?"Using":"Saving"," private key file at '").concat(v,"'.")),fs.writeFileSync(v,n),console.log("Saving license file at '".concat(w,"'.")),fs.writeFileSync(w,t)}